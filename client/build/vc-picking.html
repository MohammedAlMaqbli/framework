<head>
    <style>
body {
    margin: 0;
}

td {
   color: white;
}
.visual-control {
    background: black;
    min-height: 100%;
    color: white;
    padding: 20px;
}

.visual-control .title {
    font-weight: bold;
    width: 100%;
    text-align: center;
}

.visual-control .subtitle-section {
    display: flex;
    justify-content: space-between;
}

.visual-control .subtitle-section div {
    width: 30%;
    text-align: center;
    padding: 20px;
}

.visual-control .subtitle-section div:first-child {
    text-align: left;
}

.visual-control .subtitle-section div:last-child {
    text-align: right;
}

.visual-control .subtitle-section h3 {
    display: inline;
}

.visual-control .subtitle-section-label {
    margin-right: 2rem;
}

.visual-control .content-wrapper {
    display: flex;
}

.visual-control .content {
    padding: 20px;
}

.visual-control table {
    table-layout: fixed;
    width: 100%;
}

.visual-control table {
    border-collapse: collapse;
}

.visual-control table,
.visual-control th,
.visual-control td {
    border: 5px solid white;
}

.visual-control th,
.visual-control td {
    padding: 7px;
    text-align: center;
    font-weight: bold;
}

.visual-control th {
    color: yellow;
}

.visual-control .content h1,
.visual-control th h3 {
    margin: 0;
}

.visual-control .status-planning {
    background-color: blue;
}

.visual-control .status-on-process {
    background-color: yellow;
    color: black;
}

.visual-control .status-finish {
    background-color: green;
}

.visual-control .status-uncompleted {
    background-color: red;
}
    </style>
</head>
<body>
        <div class="visual-control">
          <h1 class="title">PICKING SCHEDULE</h1>
          <div class="subtitle-section">
            <div>
              <h3 class="subtitle-section-label">SHIFT:</h3>
              <h3 class="subtitle-section-value">1 / 2</h3>
            </div>
            <div>
              <h3 class="subtitle-section-label">Tanggal Produksi:</h3>
              <h3 class="subtitle-section-value" id="production_date"></h3>
            </div>
            <div>
              <h3 class="subtitle-section-label">Waktu Sekarang:</h3>
              <h3 class="subtitle-section-value" id="time_now"></h3>
            </div>
          </div>
          <div class="content-wrapper">
            <div class="content">
              <table>
                <tr>
                  <th colspan="8">
                    <h2>LINE MCVT</h2>
                  </th>
                </tr>
                <tr>
                  <th><h3>No</h3></th>
                  <th><h3>Seq</h3></th>
                  <th><h3>10</h3></th>
                  <th><h3>20</h3></th>
                  <th><h3>30</h3></th>
                  <th><h3>40</h3></th>
                  <th><h3>50</h3></th>
                  <th></th>
                </tr>
                <tr id="default_mcvt_row">
                  <td class="mcvt_row">1</td>
                  <td class="mcvt_trolley">IH01</td>
                  <td class="status-uncompleted">07:15</td>
                  <td class="status-uncompleted">07:30</td>
                  <td class="status-uncompleted">07:45</td>
                  <td class="status-uncompleted">08:00</td>
                  <td class="status-uncompleted">08:15</td>
                  <td></td>
                </tr>
              </table>
            </div>
            <div class="content">
              <table>
                <tr>
                  <th colspan="8">
                    <h2>LINE FLEXI</h2>
                  </th>
                </tr>
                <tr>
                  <th><h3>No</h3></th>
                  <th><h3>Seq</h3></th>
                  <th><h3>10</h3></th>
                  <th><h3>20</h3></th>
                  <th><h3>30</h3></th>
                  <th><h3>40</h3></th>
                  <th><h3>50</h3></th>
                  <th></th>
                </tr>
                <tr id="default_flexi_row">
                  <td class="flexi_row">1</td>
                  <td class="flexi_trolley">IH01</td>
                  <td class="status-uncompleted">07:15</td>
                  <td class="status-uncompleted">07:30</td>
                  <td class="status-uncompleted">07:45</td>
                  <td class="status-uncompleted">08:00</td>
                  <td class="status-uncompleted">08:15</td>
                  <td></td>
                </tr>
              </table>
            </div>
          </div>
        </div>
<script>
const rows = {}

function add_row(type, trolley) {
  row = document.getElementById('default_' + type + '_row')
  row.style.display = 'none'
  new_row = row.cloneNode(true)
  if (!rows[type]) rows[type] = 0;
  new_row.querySelector('.' + type + '_row').innerHTML = (rows[type] += 1);
  new_row.querySelector('.' + type + '_trolley').innerHTML = trolley;
  new_row.style.display = ''
  if (localStorage.last_color && rows[type] === 1) new_row.children[2].className = 'status-' + localStorage.last_color;
  row.parentElement.insertAdjacentElement('beforeend', new_row)
}

async function get_picking() {
  const date = new Date()
  document.getElementById('production_date').innerHTML = (date.toDateString()).split(' ').slice(1, -1).reverse().concat([date.getFullYear()]).join(' / ')
  document.getElementById('time_now').innerHTML = date.toTimeString().split(':').slice(0, 2).join(':')
  const promises = ['mcvt', 'flexi'].map(async (type) => {
    const records = await fetch(`http://172.16.2.21:8069/api/search?login=8c46b255e370acbdf61c5b47e4696dfa&password=982063ae578804d3c36ae646ffaecb64&encrypted=true&model=stock.picking.list&args=[["type","=","${type}"], ["called", "!=", true]]&options={"order": "sequence asc", "limit": 100}`).then((response) => response.json());
    if (!Array.isArray(records.values)) return;
    const trolleys = {};
    for (let record of records.values) {
      trolleys[record.trolley_type_id] = true;
    }
    await Promise.all(Object.keys(trolleys).map(async (trolley_id) => {
      const trolley = await fetch('http://172.16.2.21:8069/api/browse?login=8c46b255e370acbdf61c5b47e4696dfa&password=982063ae578804d3c36ae646ffaecb64&encrypted=true&model=stock.trolley.type&ids=' + trolley_id).then((response) => response.json());
      
      add_row(type, trolley.values.name || '');
    }))
    //const time = new Date()
    //time.setHours(7, 15, 0, 0, 0)
  });
  return Promise.all(promises);
}

get_picking().catch(window.alert)

function setdor(color) {
  localStorage.last_color = color;
  window.location.reload();
}

function tolong_saya() {
  if (!localStorage.last_color) setdor('on-process')
  else if (localStorage.last_color === 'on-process')  setdor('finish')
  else if (localStorage.last_color === 'finish') setdor('planning')
}
</script>
</body>
