<html><head>
    <style>
body {
    margin: 0;
}

td {
   color: white;
}

.visual-control {
    background: black;
    min-height: 100%;
    color: white;
    padding: 20px;
}

.visual-control .title {
    font-weight: bold;
    width: 100%;
    text-align: center;
}

.visual-control .subtitle-section {
    display: flex;
    justify-content: space-between;
}

.visual-control .subtitle-section div {
    width: 30%;
    text-align: center;
    padding: 20px;
}

.visual-control .subtitle-section div:first-child {
    text-align: left;
}

.visual-control .subtitle-section div:last-child {
    text-align: right;
}

.visual-control .subtitle-section h3 {
    display: inline;
}

.visual-control .subtitle-section-label {
    margin-right: 2rem;
}

.visual-control .content-wrapper {
    display: flex;
}

.visual-control .content {
    padding: 20px;
}

.visual-control table {
    table-layout: fixed;
    width: 100%;
}

.visual-control table {
    border-collapse: collapse;
}

.visual-control table,
.visual-control th,
.visual-control td {
    border: 5px solid white;
}

.visual-control th,
.visual-control td {
    padding: 7px;
    text-align: center;
    font-weight: bold;
}

.visual-control th {
    color: yellow;
}

.visual-control .content h1,
.visual-control th h3 {
    margin: 0;
}

.visual-control .status-planning {
    background-color: blue;
}

.visual-control .status-on-process {
    background-color: yellow;
    color: black;
}

.visual-control .status-finish {
    background-color: green;
}

.visual-control .status-uncompleted {
    background-color: red;
}
    </style>
</head>
<body>
        <div class="visual-control">
          <h1 class="title">TRIGGER BOARD</h1>
          <div class="subtitle-section">
            <div>
              <h3 class="subtitle-section-label">SHIFT:</h3>
              <h3 class="subtitle-section-value">1 / 2</h3>
            </div>
            <div>
              <h3 class="subtitle-section-label">Tanggal Produksi:</h3>
              <h3 id="production_date" class="subtitle-section-value">13 / Feb / 2020</h3>
            </div>
            <div>
              <h3 class="subtitle-section-label">Waktu Sekarang:</h3>
              <h3 id="time_now" class="subtitle-section-value">19:42</h3>
            </div>
          </div>
          <div class="content-wrapper">
            <div class="content">
              
              <table id="mcvt">
                <tbody><tr>
                  <th><h3>MCVT</h3></th>
                  
                  
                  
                  
                  
                </tr>
                
                
                
              </tbody></table>
            </div>
            
          <div class="content">
              
              <table id="flexi">
                <tbody><tr>
                  <th><h3>FLEXI</h3></th>
                  
                  
                  
                  
                  
                </tr>
                
                
                
              </tbody></table>
            </div></div>
        <div class="content-wrapper">
            <div class="content">
              
              <table id="fwd_trf">
                <tbody><tr>
                  <th><h3>4WD TRF</h3></th>
                  
                  
                  
                  
                  
                </tr>
                
                
                
              </tbody></table>
            </div>
            
          <div class="content">
              
              <table id="fwd_dps">
                <tbody><tr>
                  <th><h3>4WD DPS</h3></th>
                  
                  
                  
                  
                  
                </tr>
                
                
                
              </tbody></table>
            </div></div></div>
<script>
//const time = new Date()
//time.setHours(7, 15, 0, 0, 0)

async function get_board() {
  const date = new Date()
  document.getElementById('production_date').innerHTML = (date.toDateString()).split(' ').slice(1, -1).reverse().concat([date.getFullYear()]).join(' / ')
  document.getElementById('time_now').innerHTML = date.toTimeString().split(':').slice(0, 2).join(':')
  const promises = ['mcvt', 'flexi', 'fwd_trf', 'fwd_dps'].map(async (type) => {
    const records = await fetch(`http://172.16.2.21:8069/api/search?login=8c46b255e370acbdf61c5b47e4696dfa&password=982063ae578804d3c36ae646ffaecb64&encrypted=true&model=stock.trigger.board&args=[["type","=","${type}"]]&options={"order": "date asc"}`).then((response) => response.json());
    if (!records.values) return;
    const values = Array.isArray(records.values) ? records.values : [records.values];
    if (values[0]._search_count === 0) return;
    let trolleys = Promise.all(values.map(async (value, index) => {
      const trolley = await fetch('http://172.16.2.21:8069/api/browse?login=8c46b255e370acbdf61c5b47e4696dfa&password=982063ae578804d3c36ae646ffaecb64&encrypted=true&model=stock.trolley.type&ids=' + value.trolley_type_id).then((response) => response.json());
      return trolley.values.name;
    }));
    trolleys = await trolleys;      
    document.querySelectorAll('table#' + type +' .trigger-rows').forEach((row) => row.remove());
    for (let trolley of trolleys) {
      document.querySelector('table#' + type +' tbody').insertAdjacentHTML('beforeend', `<tr class="trigger-rows"><td>${trolley}</td></tr>`);
    }
  });
  await Promise.all(promises);
  setTimeout(() => get_board().catch(window.location.reload), 10 * 1000);
}

get_board().catch(window.location.reload)
</script>




</body></html>
