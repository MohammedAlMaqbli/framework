(this.webpackJsonp=this.webpackJsonp||[]).push([[0],{235:function(e,t,n){"use strict";n.d(t,"a",(function(){return z}));var r={};n.r(r),n.d(r,"Router",(function(){return D.a})),n.d(r,"Route",(function(){return L.a})),n.d(r,"Switch",(function(){return L.c})),n.d(r,"Link",(function(){return D.b}));var a=n(10),s=n.n(a),o=n(4),i=n.n(o),c=n(8),u=n.n(c),l=n(5),p=n.n(l),d=n(6),w=n.n(d),f=n(16),h=n.n(f),g=n(7),m=n.n(g),b=n(21),v=n.n(b),x=n(1),y=n.n(x),_=n(13),k=n(38),S=n(36),O=n(83),j=n(3),E=n(23),P=n(223),T=n(224),C=n(234),A=n(236),I=T.a.plugin(C.a).plugin(A.a),D=n(125),L=n(63);function B(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function R(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?B(Object(n),!0).forEach((function(t){s()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):B(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function F(e){return Object(P.sha256)(e)}window.React=y.a,window.PouchDB=I,window.session_db=new I("session");var M=function(){var e;return v.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:if("web"!==S.a.OS){t.next=2;break}return t.abrupt("return");case 2:return e={},t.next=5,v.a.awrap(Promise.all(["rapyd_home_view"].map((function(t){return v.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,v.a.awrap(O.a.getItem(t));case 2:return n.abrupt("return",e[t]=n.sent);case 3:case"end":return n.stop()}}))}))));case 5:window.localStorage=e;case 6:case"end":return t.stop()}}))}(),z=function(e){function t(e){var n,r;return i()(this,t),n=p()(this,w()(t).call(this,e)),window.renderApp=n.renderApp.bind(h()(n)),n.state={login:"",password:"",url:"",settings_popup:!1,loaded:!1},"web"===S.a.OS&&(n.state.url=(r=window.location.origin+window.location.pathname).substring(0,r.lastIndexOf("/"))+"/"),k.a.addEventListener("change",(function(){return n.setState({width:Math.min(732,Math.max(65*k.a.get("window").width/100,350))})})),n}return m()(t,e),u()(t,[{key:"clickEvent",value:function(e){e.preventDefault(),13===e.keyCode&&this.loginApp({})}},{key:"componentDidMount",value:function(){var e,t;return v.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return e=window.session_db.get("session"),n.next=3,v.a.awrap(O.a.getItem("rapyd_server_url"));case 3:if(n.t0=n.sent,n.t0){n.next=6;break}n.t0=this.state.url;case 6:return t=n.t0,this.state.url=t,n.prev=8,n.t1=this,n.next=12,v.a.awrap(e);case 12:return n.t2=n.sent,n.abrupt("return",n.t1.loginApp.call(n.t1,n.t2));case 16:n.prev=16,n.t3=n.catch(8),console.log(n.t3);case 19:return"web"===S.a.OS&&document.body.addEventListener("keyup",this.clickEvent.bind(this)),n.abrupt("return",this.setState({url:t,loaded:!0}));case 21:case"end":return n.stop()}}),null,this,[[8,16]])}},{key:"updateSession",value:function(e){var t;return v.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return e._id||(e._id="session"),t={},n.prev=2,n.next=5,v.a.awrap(window.session_db.get("session"));case 5:t=n.sent,n.next=10;break;case 8:n.prev=8,n.t0=n.catch(2);case 10:return t._rev&&(e._rev=t._rev),n.abrupt("return",window.session_db.put(e));case 12:case"end":return n.stop()}}),null,null,[[2,8]])}},{key:"loginApp",value:function(e){var t,n,a,s,o,i,c,u,l;return v.a.async((function(p){for(;;)switch(p.prev=p.next){case 0:return p.next=2,v.a.awrap(M);case 2:if(p.t0=e.login,p.t0){p.next=7;break}return p.next=6,v.a.awrap(F(this.state.login));case 6:p.t0=p.sent;case 7:if(t=p.t0,p.t1=e.password,p.t1){p.next=13;break}return p.next=12,v.a.awrap(F(t+this.state.password));case 12:p.t1=p.sent;case 13:return n=p.t1,e.login=t,e.password=n,a="/api/login?login="+t+"&password="+n,e&&e.client_js_time&&(a+="&client_js_time="+e.client_js_time),p.prev=17,p.next=20,v.a.awrap(fetch(this.state.url+a));case 20:return s=p.sent,p.next=23,v.a.awrap(s.json());case 23:if("denied"!==(o=p.sent).status){p.next=26;break}return p.abrupt("return",alert("Username/Password wrong, relogin")||this.setState({loaded:!0,ClientApp:null}));case 26:"success"!==o.status?alert("Network Error"):e=R({},e,{},o),p.next=33;break;case 29:p.prev=29,p.t2=p.catch(17),console.log(p.t2),alert("Network Error");case 33:if(e.client_js){p.next=35;break}return p.abrupt("return");case 35:if(i={},"web"===S.a.OS){p.next=40;break}(new(Function.prototype.bind.apply(Function,[null,"export_object",e.client_js])))(i),p.next=49;break;case 40:return c=new Blob([e.client_js],{type:"text/javascript"}),window.export_object=i,u=document.createElement("script"),l=new Promise((function(e,t){return(u.onload=e)&&(u.onerror=t)})),u.src=URL.createObjectURL(c),document.head.appendChild(u),p.next=48,v.a.awrap(l);case 48:delete window.export_object;case 49:return i.tools.client={components:R({},E,{},j,{},r),Native:j,MaterialComponents:E,ReactRouter:r},window.tools=i.tools,p.next=53,v.a.awrap(i.tools.init_client());case 53:return p.abrupt("return",this.updateSession(e));case 54:case"end":return p.stop()}}),null,this,[[17,29]])}},{key:"renderApp",value:function(e){return console.log(e),this.setState({ClientApp:y.a.createElement(e,null)})}},{key:"render",value:function(){var e=this;if(this.state.ClientApp)return this.state.ClientApp;if(!this.state.loaded)return y.a.createElement(_.a,null);window.r=this.render;var t=this.state.width||Math.min(732,Math.max(65*k.a.get("window").width/100,350));return y.a.createElement(_.a,{style:{alignItems:"center",marginTop:34}},y.a.createElement(E.Heading,{type:3,text:"Welcome"}),y.a.createElement(E.TextField,{containerStyle:{marginTop:20},style:{fontSize:17,marginBottom:10,width:t},label:"Username",leadingIcon:y.a.createElement(E.Icon,{name:"account-circle",size:24,color:"#6e6e6e"}),type:"flat",value:this.state.login,onChangeText:function(t){return e.setState({login:t})}}),y.a.createElement(E.TextField,{secureTextEntry:!0,password:"web"!==S.a.OS||void 0,containerStyle:{marginTop:10},style:{fontSize:17,marginBottom:10,width:t},label:"Password",leadingIcon:y.a.createElement(E.Icon,{name:"lock",size:24,color:"#6e6e6e"}),type:"flat",value:this.state.password,onChangeText:function(t){return e.setState({password:t})}}),y.a.createElement(_.a,{style:{marginTop:10,flexDirection:"row"}},y.a.createElement(E.Button,{text:"Login",onPress:function(){return e.loginApp({})}}),y.a.createElement(E.Button,{text:"Settings",style:{marginLeft:t-150},onPress:function(){return e.setState({settings_popup:!0})}})),y.a.createElement(E.Dialog,{visible:this.state.settings_popup,onTouchOutside:function(){return e.setState({settings_popup:!1})},title:"Server URL",actionItems:[{text:"Cancel",onPress:function(){return e.setState({settings_popup:!1})}},{text:"OK",onPress:function(){return O.a.setItem("rapyd_server_url",e.state.url)&&e.setState({settings_popup:!1})}}]},y.a.createElement(E.TextField,{type:"flat",value:this.state.url,onChangeText:function(t){return e.setState({url:t})},containerStyle:{marginTop:-30,marginBottom:10},style:{fontSize:17,marginBottom:10,width:250}})))}}]),t}(y.a.Component)},237:function(e,t,n){n(238),e.exports=n(583)},238:function(e,t){"serviceWorker"in navigator&&window.addEventListener("load",(function(){navigator.serviceWorker.register("/expo-service-worker.js",{scope:"/"}).then((function(e){})).catch((function(e){console.info("Failed to register service-worker",e)}))}))}},[[237,1,2]]]);
//# sourceMappingURL=app.cee9af8f.chunk.js.map