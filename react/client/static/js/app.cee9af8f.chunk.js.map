{"version":3,"sources":["PouchDB.web.js","App.js","web-build/register-service-worker.js"],"names":["PouchDB","plugin","PouchFind","RelationalPouch","digest","text","sha256","window","React","session_db","initLocalStorage","a","async","Platform","OS","localStorage","Promise","all","map","key","AsyncStorage","getItem","props","href","renderApp","bind","state","login","password","url","settings_popup","loaded","location","origin","pathname","substring","lastIndexOf","Dimensions","addEventListener","setState","width","Math","min","max","get","event","preventDefault","keyCode","this","loginApp","session","console","log","document","body","clickEvent","_id","old_session","_rev","put","path","client_js_time","fetch","response","json","new_session","status","alert","ClientApp","client_js","orm","Function","prototype","apply","blob","Blob","type","export_object","script","createElement","resolve","reject","onload","onerror","src","URL","createObjectURL","head","appendChild","tools","client","components","MaterialComponents","Native","Router","ReactRouter","init_client","updateSession","App","View","r","render","style","alignItems","marginTop","containerStyle","fontSize","marginBottom","label","leadingIcon","name","size","color","value","onChangeText","secureTextEntry","undefined","flexDirection","onPress","marginLeft","visible","onTouchOutside","title","actionItems","setItem","Component","navigator","serviceWorker","register","scope","then","info","catch","error"],"mappings":"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","file":"static/js/app.cee9af8f.chunk.js","sourcesContent":["import PouchDB from 'pouchdb-browser';\nimport PouchFind from 'pouchdb-find';\nimport RelationalPouch from 'relational-pouch';\nexport default PouchDB.plugin(PouchFind).plugin(RelationalPouch);","import React, { Component } from 'react';\nimport { View, Dimensions, Platform, AsyncStorage } from 'react-native';\nimport * as Native from 'react-native';\nimport { TextField, Heading, Icon, Button, Dialog } from 'material-bread';\nimport * as MaterialComponents from 'material-bread';\nimport { sha256 } from 'js-sha256';\nimport PouchDB from './PouchDB';\nimport * as Router from './Router';\n\nwindow.React = React;\nwindow.PouchDB = PouchDB;\nwindow.session_db = new PouchDB('session');\n\nfunction digest(text) {\n  return sha256(text);\n}\n\nconst initLocalStorage = (async () => {\n  if (Platform.OS === 'web') return;\n  const localStorage = {};\n  await Promise.all(['rapyd_home_view'].map(async (key) => (localStorage[key] = await AsyncStorage.getItem(key))));\n  window.localStorage = localStorage;\n})();\n\nexport default class extends React.Component {\n  constructor(props) {\n    super(props);\n    window.renderApp = this.renderApp.bind(this);\n    this.state = {\n      login: '',\n      password: '',\n      url: '',\n      settings_popup: false,\n      loaded: false\n    }\n    if (Platform.OS === 'web') this.state.url = ((href) => href.substring(0, href.lastIndexOf('/')) + '/')(window.location.origin + window.location.pathname);\n    Dimensions.addEventListener('change', () => this.setState({width: Math.min(732, Math.max(Dimensions.get('window').width * 65/100, 350))}))\n  }\n\n  clickEvent(event) {\n    event.preventDefault();\n    if (event.keyCode === 13) {\n      this.loginApp({});\n    };\n  }\n\n  async componentDidMount() {\n    let session = window.session_db.get('session');\n    const url = (await AsyncStorage.getItem('rapyd_server_url') || this.state.url);\n    this.state.url = url;\n    try {\n      return this.loginApp(await session);\n    }\n    catch (error) {\n      console.log(error)\n    }\n    if (Platform.OS === 'web') document.body.addEventListener('keyup', this.clickEvent.bind(this));\n    return this.setState({url, loaded: true})\n  }\n\n  async updateSession(session) {\n    if (!session._id) session._id = 'session';\n    let old_session = {};\n    try {\n      old_session = await window.session_db.get('session')\n    }\n    catch (error) {}\n    if (old_session._rev) session._rev = old_session._rev;\n    return window.session_db.put(session);\n  }\n\n  async loginApp(session) {\n    await initLocalStorage;\n    const login = session.login || await digest(this.state.login);\n    const password = session.password || await digest(login + this.state.password);\n    session.login = login, session.password = password;\n    let path = `/api/login?login=${login}&password=${password}`\n    if (session && session.client_js_time) path += '&client_js_time=' + session.client_js_time;\n    try {\n      const response = await fetch(this.state.url + path);\n      const new_session = await response.json();\n      if (new_session.status === 'denied') return alert('Username/Password wrong, relogin') || this.setState({loaded: true, ClientApp: null})\n      if (new_session.status !== 'success') alert('Network Error')\n      else {\n        session = {...session, ...new_session};\n      }\n    }\n    catch (error) {\n      console.log(error);\n      alert('Network Error')\n    }\n    if (!session.client_js) return;\n    const orm = {};\n    if (Platform.OS !== 'web') new (Function.prototype.bind.apply(Function, [null, 'export_object', session.client_js]))()(orm);\n    else {\n      const blob = new Blob([session.client_js], {type: 'text/javascript'});\n      window.export_object = orm;\n      const script = document.createElement('script');\n      const loaded = new Promise((resolve, reject) => (script.onload = resolve) && (script.onerror = reject));\n      script.src = URL.createObjectURL(blob);\n      document.head.appendChild(script);\n      await loaded;\n      delete window.export_object;\n    }\n    orm.tools.client = {components: {...MaterialComponents, ...Native, ...Router}, Native, MaterialComponents, ReactRouter: Router};\n    window.tools = orm.tools;\n    await orm.tools.init_client();\n    return this.updateSession(session);\n  }\n\n  renderApp(App) {\n    console.log(App);\n    return this.setState({ClientApp: <App/>})\n  }\n\n  render() {\n    if (this.state.ClientApp) return this.state.ClientApp;\n    if (!this.state.loaded) return <View/>;\n    window.r = this.render;\n    const width = this.state.width || Math.min(732, Math.max(Dimensions.get('window').width * 65/100, 350));\n    return (\n    \n      <View style={{alignItems: 'center', marginTop: 34}}>\n\n        <Heading type={3} text='Welcome'/>\n\n        <TextField\n          containerStyle={{marginTop: 20}}\n          style={{fontSize: 17, marginBottom: 10, width: width}}\n          label={'Username'}\n          leadingIcon={\n            <Icon name={'account-circle'} size={24} color={'#6e6e6e'} />\n          }\n          type={'flat'}\n          value={this.state.login}\n          onChangeText={value => this.setState({ login: value})}\n        />\n\n        <TextField\n          secureTextEntry={true}\n          password={Platform.OS !== 'web' ? true : undefined}\n          containerStyle={{marginTop: 10}}\n          style={{fontSize: 17, marginBottom: 10, width: width}}\n          label={'Password'}\n          leadingIcon={\n            <Icon name={'lock'} size={24} color={'#6e6e6e'} />\n          }\n          type={'flat'}\n          value={this.state.password}\n          onChangeText={value => this.setState({ password: value})}\n        />\n        <View style={{marginTop: 10, flexDirection: 'row'}}>\n          <Button text='Login' onPress={() => this.loginApp({})}/>\n          <Button text='Settings' style={{marginLeft: (width) - 150}} onPress={() => this.setState({settings_popup: true})}/>\n        </View>\n\n        <Dialog visible={this.state.settings_popup}\n          onTouchOutside={() => this.setState({ settings_popup: false })}\n          title={'Server URL'}\n          actionItems={[{text: 'Cancel', onPress: () => this.setState({settings_popup: false})}, {text: 'OK', onPress: () => AsyncStorage.setItem('rapyd_server_url', this.state.url) && this.setState({settings_popup: false})}]}>\n          <TextField type='flat' value={this.state.url} onChangeText={value => this.setState({ url: value})} containerStyle={{marginTop: -30, marginBottom: 10}} style={{fontSize: 17, marginBottom: 10, width: 250}}/>\n        </Dialog>\n\n      </View>\n    \n    );\n  \n  }\n\n}\n\n","/* eslint-env browser */\n\nif ('serviceWorker' in navigator) {\n  window.addEventListener('load', function () {\n    navigator.serviceWorker\n      .register('/expo-service-worker.js', { scope: '/' })\n      .then(function (info) {\n        // console.info('Registered service-worker', info);\n      })\n      .catch(function (error) {\n        console.info('Failed to register service-worker', error);\n      });\n  });\n}\n"],"sourceRoot":""}