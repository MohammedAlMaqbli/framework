(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{0:function(e,t){if(!window.React)throw Error("React must be defined on global variable");e.exports=window.React},208:function(e,t,n){e.exports=n(330)},240:function(e,t,n){},242:function(e,t,n){},330:function(e,t,n){"use strict";n.r(t);var r,a=n(19),o=n.n(a),s=n(32),i=n(60),c=n(0),l=n.n(c),u=n(79),p=n.n(u),d=n(206),w=n(22),f=n(2),v=n(5),b=n(1),g=n(3),m=n(4),h=n(64),_=n(207),y=n(201),x=n.n(y);h.a.plugin(_.a),h.a.plugin(x.a),h.a.plugin(n(223).default),window.PouchDB=h.a,window.session_db=new h.a("session"),window.rapyd_config||(window.rapyd_config={}),window.localStorage.rapyd_server_url||(window.rapyd_config.url?window.localStorage.rapyd_server_url=window.rapyd_config.url:"file:"===window.location.protocol?window.localStorage.rapyd_server_url="http://localhost:8069":window.localStorage.rapyd_server_url=(r=window.location.origin+window.location.pathname).substring(0,r.lastIndexOf("/"))+"/");var j={};function k(){var e=document.getElementById("app");if(e){var t={done:function(e){return j.preload_count-=1,0!=j.preload_count?e:(delete j.preload_count,j.preload_loader.remove(),j.preload_backdrop.remove(),e)}};if(j.preload_count)return j.preload_count+=1,t;j.preload_count=1;var n=document.createElement("div");n.className="preloader-modal",n.insertAdjacentHTML("beforeend",'\n    <div class="preloader color-white">\n      <span class="preloader-inner">\n        <span class="preloader-inner-gap"></span>\n        <span class="preloader-inner-left">\n          <span class="preloader-inner-half-circle"></span>\n        </span>\n        <span class="preloader-inner-right">\n          <span class="preloader-inner-half-circle"></span>\n        </span>\n      </span>\n    </div>');var r=document.createElement("div");return r.className="preloader-backdrop",e.insertAdjacentElement("beforeend",r),e.insertAdjacentElement("beforeend",n),j.preload_loader=n,j.preload_backdrop=r,t}}function E(){return(E=Object(s.a)(o.a.mark(function e(){var t,n,r,a;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=window.session_db,!D.models){e.next=3;break}return e.abrupt("return",{models:D.models,tools:D.tools,local_db:D.local_db});case 3:return e.prev=3,e.prev=4,e.next=7,t.get("session");case 7:n=e.sent,e.next=13;break;case 10:return e.prev=10,e.t0=e.catch(4),e.abrupt("return",{});case 13:return e.prev=13,e.next=16,S({login:n.login,password:n.password,encrypted:!0,client_js_time:n.client_js_time});case 16:if(r=e.sent){e.next=23;break}return e.next=20,I();case 20:window.location.reload(),e.next=24;break;case 23:r.client_js||(r.client_js=n.client_js);case 24:n=r,e.next=30;break;case 27:e.prev=27,e.t1=e.catch(13),console.log(e.t1);case 30:return e.next=32,L(n);case 32:return a=e.sent,D.models=a.models,D.tools=a.tools,D.local_db=a.local_db,e.abrupt("return",a);case 39:throw e.prev=39,e.t2=e.catch(3),e.t2;case 44:case"end":return e.stop()}},e,null,[[3,39],[4,10],[13,27]])}))).apply(this,arguments)}function O(){return(O=Object(s.a)(o.a.mark(function e(t){var n;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,window.session_db.get("session");case 2:return n=e.sent,e.next=5,window.session_db.put(Object(i.a)({},n,t));case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}},e)}))).apply(this,arguments)}function S(e){return R.apply(this,arguments)}function R(){return(R=Object(s.a)(o.a.mark(function e(t){var r,a;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t.encrypted=!!t.encrypted,t.compress=!0,e.next=4,B("post","json",window.localStorage.rapyd_server_url+"/api/login",t);case 4:if("denied"!==(r=e.sent).status){e.next=9;break}return e.abrupt("return",!1);case 9:if("error"!==r.status){e.next=11;break}throw Error("There are an error on the server");case 11:return t.compress&&T(r.client_js)&&(r.client_js=n(226).LZMA.decompress(P(r.client_js))),console.log(r),e.prev=13,e.next=16,window.session_db.get("session");case 16:a=e.sent,r._rev=a._rev,r.unsaved=a.unsaved,r.client_js=r.client_js||a.client_js,r.client_js_time=r.client_js_time||a.client_js_time,e.next=26;break;case 23:e.prev=23,e.t0=e.catch(13),r.unsaved={};case 26:return r._id="session",e.next=29,window.session_db.put(r);case 29:return e.abrupt("return",r);case 30:case"end":return e.stop()}},e,null,[[13,23]])}))).apply(this,arguments)}function I(){return C.apply(this,arguments)}function C(){return(C=Object(s.a)(o.a.mark(function e(){var t;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,window.session_db.get("session");case 3:return t=e.sent,e.next=6,window.session_db.remove(t);case 6:e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),console.log(e.t0);case 11:return window.local_db.destroy(),e.abrupt("return",window.location.reload());case 13:case"end":return e.stop()}},e,null,[[0,8]])}))).apply(this,arguments)}function L(e){return U.apply(this,arguments)}function U(){return(U=Object(s.a)(o.a.mark(function e(t){var r,a,s,i,c,l,u,p;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r="undefined"!=typeof navigator&&"ReactNative"==navigator.product,a={},("true"===window.localStorage.debug_pretty||r)&&(t.client_js=n(229)(t.client_js,{url:"orm_code",indent:"  "}).code.replace(/asyncfunction/g,"async function").replace(/awaitawait_all/g,"await await_all")),!r){e.next=7;break}(new(Function.prototype.bind.apply(Function,[null,"export_object",t.client_js])))(a),e.next=14;break;case 7:t.client_js="var export_object = {};\n"+t.client_js+"\nexport default export_object;",s=window.URL||window.webkitURL;try{i=new Blob([t.client_js],{type:"text/javascript"})}catch(o){c=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder,(i=c()).append(t.client_js),i=i.getBlob("text/javascript")}return e.next=12,import(s.createObjectURL(i));case 12:l=e.sent,a=l.default;case 14:return(u=a.tools).configuration=Object.assign(u.configuration,window.rapyd_config),u.configuration.url=window.localStorage.rapyd_server_url,(p=a.models).env.context.unsaved=t.unsaved||{},p.env.user=p.env["res.users"].browse(),p.env.user.id=t.id,p.env.user.login=t.login,p.env.user.password=t.password,e.next=25,u.create_data();case 25:return console.log(t),u.configuration.ajax_load=function(e){e.no_preload||(e.preload=k())},u.configuration.ajax_resolve=function(e,t,n){n.no_preload||n.preload.done(),e(t.response)},u.configuration.ajax_reject=function(e,t,n){n.no_preload||n.preload.done(),e(t)},j.exceptionCount=0,u.configuration.exception=function(e){if(j.exceptionCount+=1,e&&Object.keys(u.exceptions).find(function(t){return t===e.type||u.exceptions[t]===e.constructor}))throw"ServerError"!==e.type?j.app.dialog.alert(e.message):j.app.dialog.alert("There are some error"),new Error(e.message);throw j.app.dialog.alert("Network Error"),e},j.warningCount=0,u.configuration.warning=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(0!==j.warningCount)return new Promise(function(t){j.warningCount=0,t(!0),console.warn(e)});t&&j.app.toast.create({text:"You are offline, using local data",closeButton:!0,closeTimeout:1e3}).open(),j.warningCount+=1,console.warn(e)},j.orm_ready(a),e.abrupt("return",a);case 35:case"end":return e.stop()}},e)}))).apply(this,arguments)}function B(e,t,n,r){return void 0!==r&&(r=A(r)),new Promise(function(a,o){var s=new XMLHttpRequest;s.open(e,n,!0),s.onload=function(){a(this.response)},s.onerror=function(){o(this.statusText)},void 0===t&&(t="json"),s.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),s.responseType=t;try{s.send(r)}catch(i){o(i)}})}function A(e){var t=[];for(var n in e){var r=e[n];"object"===typeof r?r=JSON.stringify(r):""===r&&(r=null),t.push(encodeURIComponent(n)+"="+encodeURIComponent(r))}return t.join("&")}function T(e){try{return window.btoa(window.atob(e))===e}catch(t){return!1}}function P(e){e=window.atob(e);for(var t=new Uint8Array(e.length),n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}j.orm=new Promise(function(e){return j.orm_ready=e});var D={globals:j,preload:k,get_session:function(){return E.apply(this,arguments)},update_session:function(e){return O.apply(this,arguments)},wait:function(e){return new Promise(function(t,n){setTimeout(function(){return t()},e)})},wait_exist:function(e){return new Promise(function(t,n){var r=setInterval(function(){e()&&(clearInterval(r),t())},0)})},login:S,logout:I,ORM:L,handleClientError:function(e){if(!(D.tools&&e&&Object.values(D.tools.exceptions).find(function(t){return t===e.constructor})))throw e;D.tools.configuration.exception(e)},ajax:B,readAsDataURL:function(e){var t=k();return new Promise(function(t,n){e||n(new Error("No file available"));var r=new FileReader;r.onload=function(e){return t(e.target.result)},r.readAsDataURL(e)}).then(t.done).catch(function(e){throw t.done(),e})},parseURI:A,hasValue:function(e,t){return void 0!==e&&null!==e&&!1!==e&&([Array,String].indexOf(e.constructor)<0&&(e=e.toString()),e.indexOf(t)>-1)},hasKey:function(e,t){return void 0!==e&&null!==e&&!1!==e&&Object.keys(e).indexOf(t)>-1}},M=D,N=function(e){function t(e){var n;return Object(f.a)(this,t),(n=Object(b.a)(this,Object(g.a)(t).call(this,e))).state={username:"",password:""},n}return Object(m.a)(t,e),Object(v.a)(t,[{key:"componentDidMount",value:function(){var e=Object(s.a)(o.a.mark(function e(){var t,n,r,a,s,i;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(t=!0,n=!1,r=void 0,e.prev=3,a=document.querySelectorAll("input[type=text], input[type=password]")[Symbol.iterator]();!(t=(s=a.next()).done);t=!0)s.value.addEventListener("keyup",this.clickEvent.bind(this));e.next=11;break;case 7:e.prev=7,e.t0=e.catch(3),n=!0,r=e.t0;case 11:e.prev=11,e.prev=12,t||null==a.return||a.return();case 14:if(e.prev=14,!n){e.next=17;break}throw r;case 17:return e.finish(14);case 18:return e.finish(11);case 19:if(i=M.preload(),!window.rapyd_config.choose_database){e.next=27;break}return e.t1=this,e.next=24,M.ajax("get","json",window.localStorage.rapyd_server_url+"/api/databases");case 24:e.t2=e.sent,e.t3={databases:e.t2},e.t1.setState.call(e.t1,e.t3);case 27:i.done();case 28:case"end":return e.stop()}},e,this,[[3,7,11,19],[12,,14,18]])}));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this;return l.a.createElement(w.Page,{noToolbar:!0,noNavbar:!0,noSwipeback:!0,loginScreen:!0},l.a.createElement(w.LoginScreenTitle,null,"Welcome"),l.a.createElement(w.List,{form:!0},this.state.databases&&l.a.createElement(w.ListInput,{required:!0,id:"login-page-database",label:"Database",type:"select",onInput:function(t){e.setState({database:t.target.value})}},l.a.createElement("option",{disabled:!0,selected:!0,value:""},"Choose"),this.state.databases&&this.state.databases.map(function(e){return l.a.createElement("option",{style:{color:"#212121"},value:e},e)})),l.a.createElement(w.ListInput,{label:"Username",type:"text",placeholder:"Your username",value:this.state.username,onInput:function(t){e.setState({username:t.target.value})},autofocus:!0}),l.a.createElement(w.ListInput,{label:"Password",type:"password",placeholder:"Your password",value:this.state.password,onInput:function(t){e.setState({password:t.target.value})}}),l.a.createElement(w.Button,{onClick:this.signIn.bind(this),style:{float:"left",marginLeft:"10px"}},"Login"),l.a.createElement(w.Button,{onClick:this.setUrl.bind(this),style:{float:"right",marginRight:"10px"}},"Settings")))}},{key:"clickEvent",value:function(e){e.preventDefault(),13===e.keyCode&&this.signIn()}},{key:"setUrl",value:function(){this.$f7.dialog.prompt("","Server URL",function(e){return localStorage.rapyd_server_url=e});var e=document.querySelector("input.dialog-input");e&&(e.value=localStorage.rapyd_server_url)}},{key:"signIn",value:function(){var e=Object(s.a)(o.a.mark(function e(){var t,n,r,a;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=M.preload(),r=(n=this).$f7,e.prev=3,e.next=6,M.login(Object(i.a)({login:n.state.username,password:n.state.password,encrypted:!1},this.state.database?{database:this.state.database}:{}));case 6:if(a=e.sent,t.done(),a){e.next=10;break}return e.abrupt("return",r.dialog.alert("Username/Password wrong, relogin"));case 10:r.dialog.alert("Login Successful!",function(){window.location.reload()}),e.next=18;break;case 13:throw e.prev=13,e.t0=e.catch(3),t.done(),r.dialog.alert("Network Error"),e.t0;case 18:case"end":return e.stop()}},e,this,[[3,13]])}));return function(){return e.apply(this,arguments)}}()}]),t}(l.a.Component),q=function(){return[{path:"(.*)",component:N}]},F=function(e){var t={id:"org.rapyd.client",name:"App",theme:"md",routes:q(),panel:{swipe:"left",leftBreakpoint:960,swipeThreshold:230}};return l.a.createElement(w.App,{params:t,colorTheme:"gray"},l.a.createElement(w.Statusbar,null),l.a.createElement(w.View,{id:"main-view",url:"/",main:!0,className:"ios-edges",preloadPreviousPage:!1,pushState:!0}))},H=(n(238),n(240),n(242),n(140)),J=(n(296),n(202)),Y=n.n(J),G=(n(298),n(203)),K=(n(326),n(328),n(204)),V=n.n(K),W=n(205),$=n.n(W),z=n(81);z.install({onInstalled:function(){return z.update()},onUpdateReady:function(){return M.tools?M.globals.app.dialog.confirm("Update available, apply it?",function(){return z.applyUpdate(function(){return window.location.reload()})}):z.applyUpdate(function(){return window.location.reload()})}}),d.a.use(w.default),window.React=l.a,window.ReactDOM=p.a,window.rapydComponents=Object(i.a)({},w,window.rapydComponents),M.client={api:M,components:window.rapydComponents,selectivity:{Selectivity:H.React,Templates:H.Templates},flatpickr:Y.a,csv:V.a,Framework7Components:w,FileSaver:$.a,AgGridReact:G.AgGridReact},Object(s.a)(o.a.mark(function e(){var t,n;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=M.get_session();try{window.addEventListener("beforeinstallprompt",function(){var e=Object(s.a)(o.a.mark(function e(n){return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n.preventDefault(),e.next=3,t;case 3:return M.globals.InstallPromp=n,e.next=6,M.wait_exist(function(){return document.getElementById("pwa_install_button")});case 6:document.getElementById("pwa_install_button").style.display="inline-block";case 7:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}())}catch(r){console.error(r)}return e.next=4,t;case 4:if(n=M.tools){e.next=9;break}return e.abrupt("return",p.a.render(l.a.createElement(F),document.getElementById("app")));case 9:return n.client=M.client,e.abrupt("return",n.init_client());case 11:case"end":return e.stop()}},e)}))()},79:function(e,t){if(!window.ReactDOM)throw Error("ReactDOM must be defined on global variable");e.exports=window.ReactDOM}},[[208,2,1]]]);
//# sourceMappingURL=main.1c308aab.chunk.js.map